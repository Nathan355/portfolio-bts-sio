-- Création des tables
CREATE TABLE patient (
    patient_id INT PRIMARY KEY,
    nom VARCHAR(50),
    prenom VARCHAR(50),
    date_naissance DATE,
    adresse TEXT,
    email VARCHAR(100),
    sexe CHAR(1),
    date_inscription DATETIME
);

CREATE TABLE medecin (
    medecin_id INT PRIMARY KEY,
    nom VARCHAR(50),
    prenom VARCHAR(50),
    specialite VARCHAR(50),
    telephone VARCHAR(20),
    email VARCHAR(100),
    date_embauche DATE
);

CREATE TABLE rendezvous (
    rendezvous_id INT PRIMARY KEY,
    patient_id INT,
    medecin_id INT,
    date_rendezvous DATETIME,
    statut VARCHAR(20),
    FOREIGN KEY (patient_id) REFERENCES patient(patient_id),
    FOREIGN KEY (medecin_id) REFERENCES medecin(medecin_id)
);

CREATE TABLE consultation (
    consultation_id INT PRIMARY KEY,
    patient_id INT,
    medecin_id INT,
    date_consultation DATETIME,
    diagnostique TEXT,
    prescriptions TEXT,
    FOREIGN KEY (patient_id) REFERENCES patient(patient_id),
    FOREIGN KEY (medecin_id) REFERENCES medecin(medecin_id)
);

-- 1. Afficher tous les rendez-vous avec les noms des patients et des médecins
SELECT r.*, p.nom AS nom_patient, p.prenom AS prenom_patient, m.nom AS nom_medecin, m.prenom AS prenom_medecin
FROM rendezvous r
JOIN patient p ON r.patient_id = p.patient_id
JOIN medecin m ON r.medecin_id = m.medecin_id;

-- 2. Afficher toutes les consultations avec le diagnostic et la prescription
SELECT c.*, p.nom AS nom_patient, p.prenom AS prenom_patient, m.nom AS nom_medecin, m.prenom AS prenom_medecin
FROM consultation c
JOIN patient p ON c.patient_id = p.patient_id
JOIN medecin m ON c.medecin_id = m.medecin_id;

-- 3. Trouver les patients ayant consulté un cardiologue
SELECT DISTINCT p.*
FROM consultation c
JOIN patient p ON c.patient_id = p.patient_id
JOIN medecin m ON c.medecin_id = m.medecin_id
WHERE m.specialite = 'Cardiologie';

-- 4. Lister tous les médecins ayant déjà eu au moins une consultation
SELECT DISTINCT m.*
FROM consultation c
JOIN medecin m ON c.medecin_id = m.medecin_id;

-- 5. Trouver tous les rendez-vous annulés avec les détails
SELECT r.*, p.nom AS nom_patient, p.prenom AS prenom_patient, m.nom AS nom_medecin, m.prenom AS prenom_medecin
FROM rendezvous r
JOIN patient p ON r.patient_id = p.patient_id
JOIN medecin m ON r.medecin_id = m.medecin_id
WHERE r.statut = 'Annulé';

-- 6. Trouver les patients qui ont reçu une prescription contenant "Médicament A"
SELECT DISTINCT p.*
FROM consultation c
JOIN patient p ON c.patient_id = p.patient_id
WHERE c.prescriptions LIKE '%Médicament A%';

-- 7. Trouver quel médecin a le plus de consultations
SELECT m.*, COUNT(c.consultation_id) AS nb_consultations
FROM consultation c
JOIN medecin m ON c.medecin_id = m.medecin_id
GROUP BY m.medecin_id
ORDER BY nb_consultations DESC
LIMIT 1;

-- 8. Vérifier si des patients ont eu une consultation après leur inscription
SELECT p.*
FROM consultation c
JOIN patient p ON c.patient_id = p.patient_id
WHERE c.date_consultation > p.date_inscription;

-- 9. Trouver les rendez-vous pris avec des médecins embauchés après 2021
SELECT r.*
FROM rendezvous r
JOIN medecin m ON r.medecin_id = m.medecin_id
WHERE m.date_embauche > '2021-12-31';

-- 10. Trouver le dernier rendez-vous de chaque patient
SELECT patient_id, MAX(date_rendezvous) AS dernier_rendezvous
FROM rendezvous
GRO<
SELECT p.*, r.rendezvous_id, r.date_rendezvous, r.statut
FROM patient p
LEFT JOIN rendezvous r ON p.patient_id = r.patient_id;


SELECT m.*, c.consultation_id, c.date_consultation, c.diagnostique, c.prescriptions
FROM medecin m
LEFT JOIN consultation c ON m.medecin_id = c.medecin_id;

SELECT DISTINCT p.*
FROM patient p
JOIN rendezvous r ON p.patient_id = r.patient_id
LEFT JOIN consultation c ON p.patient_id = c.patient_id
WHERE c.consultation_id IS NULL;


SELECT m.specialite, m.nom, m.prenom, COUNT(DISTINCT c.patient_id) AS nb_patients
FROM medecin m
LEFT JOIN consultation c ON m.medecin_id = c.medecin_id
GROUP BY m.specialite, m.nom, m.prenom;


SELECT p.patient_id, p.nom, p.prenom, GROUP_CONCAT(DISTINCT m.specialite) AS specialites
FROM patient p
JOIN consultation c ON p.patient_id = c.patient_id
JOIN medecin m ON c.medecin_id = m.medecin_id
GROUP BY p.patient_id;


SELECT m.medecin_id, m.nom, m.prenom, COUNT(r.rendezvous_id) AS total_rendezvous
FROM medecin m
LEFT JOIN rendezvous r ON m.medecin_id = r.medecin_id
WHERE r.statut = 'Programmé'
GROUP BY m.medecin_id;


SELECT r.*, p.nom AS nom_patient, p.prenom AS prenom_patient
FROM rendezvous r
LEFT JOIN patient p ON r.patient_id = p.patient_id;
